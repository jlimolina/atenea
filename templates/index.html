<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atenea - Asistente Multimodal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="logo">🦉</span> Atenea</h1>
            <p class="subtitle">Tu asistente multimodal de inteligencia artificial</p>
        </header>

        {% if error %}
            <div class="error-message"><strong>Error:</strong> {{ error }}</div>
        {% endif %}
        
        <div class="info-box">
            <span class="info-icon">💡</span>
            <span>Selecciona un modo y escribe tu texto para interactuar con los modelos de IA</span>
        </div>

        <form id="main-form" action="/ask" method="post">
            <div class="mode-selector">
                <label class="mode-option llm active" id="llm-option">
                    <input type="radio" name="mode" value="llm" checked hidden> Modelo de Lenguaje (LLM)
                </label>
                <label class="mode-option tts" id="tts-option">
                    <input type="radio" name="mode" value="tts" hidden> Texto a Voz (TTS)
                </label>
            </div>

            <div class="form-section" id="llm-section">
                <label for="model">Selecciona un modelo LLM:</label>
                <select name="model" id="model" required>
                    {% if models %}
                        <option value="" disabled selected>-- Elige un modelo --</option>
                        {% for model_name in models %}<option value="{{ model_name }}">{{ model_name }}</option>{% endfor %}
                    {% else %}
                        <option value="" disabled selected>-- No hay modelos --</option>
                    {% endif %}
                </select>
            </div>
            
            <div class="form-section" id="tts-engine-section">
                <label for="tts_engine">Motor de Voz:</label>
                <select name="tts_engine" id="tts_engine">
                    <option value="silero">Silero</option>
                    <option value="coqui">Coqui TTS (Clonación)</option>
                </select>
            </div>

            <div class="form-section" id="tts-speaker-section">
                <label for="tts_speaker">Voz / Locutor:</label>
                <select name="tts_speaker" id="tts_speaker" required>
                    </select>
            </div>

            <div class="form-section">
                <label for="question" id="question-label">Tu consulta:</label>
                <textarea name="question" id="question" minlength="3" required placeholder="Escribe tu texto aquí..."></textarea>
            </div>

            <button type="submit" id="submit-btn">
                <span id="submit-text">Generar Respuesta</span>
                <span id="loading-indicator" style="display:none;">Procesando...</span>
            </button>
        </form>
         <footer>
            Atenea AI v2.0 | Sistema Multimodal LLM + TTS
        </footer>
    </div>

    <script>
        // --- LÓGICA DE LA INTERFAZ DINÁMICA ---
        const llmSection = document.getElementById('llm-section');
        const ttsEngineSection = document.getElementById('tts-engine-section');
        const ttsSpeakerSection = document.getElementById('tts-speaker-section');
        
        const llmModelSelect = document.getElementById('model');
        const ttsEngineSelect = document.getElementById('tts_engine');
        const ttsSpeakerSelect = document.getElementById('tts_speaker');

        // Definimos las voces disponibles para cada motor
        const voicesByEngine = {
            'silero': {
                'Voz Femenina 1': 'es_0',
                'Voz Femenina 2': 'es_1',
                'Voz Femenina 3': 'es_2',
            },
            'coqui': {
                'Mi Voz Clonada 1': 'voices/voz_clonada_1.wav',
                'Mi Voz Clonada 2': 'voices/voz_clonada_2.wav',
            }
        };

        function updateSpeakerOptions() {
            const selectedEngine = ttsEngineSelect.value;
            ttsSpeakerSelect.innerHTML = ''; // Limpiar opciones anteriores

            const availableVoices = voicesByEngine[selectedEngine];
            for (const name in availableVoices) {
                const value = availableVoices[name];
                const option = new Option(name, value);
                ttsSpeakerSelect.add(option);
            }
        }

        function updateFormMode() {
            const isTTSMode = document.querySelector('input[name="mode"]:checked').value === 'tts';

            // Mostrar u ocultar las secciones correspondientes
            llmSection.style.display = isTTSMode ? 'none' : 'block';
            ttsEngineSection.style.display = isTTSMode ? 'block' : 'none';
            ttsSpeakerSection.style.display = isTTSMode ? 'block' : 'none';

            // Habilitar/deshabilitar campos para que la validación 'required' funcione correctamente
            llmModelSelect.disabled = isTTSMode;
            ttsEngineSelect.disabled = !isTTSMode;
            ttsSpeakerSelect.disabled = !isTTSMode;
            
            // Actualizar clases y textos
            document.getElementById('llm-option').classList.toggle('active', !isTTSMode);
            document.getElementById('tts-option').classList.toggle('active', isTTSMode);
            document.getElementById('question-label').textContent = isTTSMode ? 'Texto a convertir a voz:' : 'Tu consulta:';
            document.getElementById('submit-text').textContent = isTTSMode ? 'Generar Audio' : 'Generar Respuesta';
        }
        
        // Manejar envío del formulario
        document.getElementById('main-form').addEventListener('submit', function() {
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const loadingIndicator = document.getElementById('loading-indicator');

            submitBtn.disabled = true;
            submitText.style.display = 'none';
            loadingIndicator.style.display = 'inline';
        });

        // Event Listeners
        document.getElementById('llm-option').addEventListener('click', () => {
             document.querySelector('input[name="mode"][value="llm"]').checked = true;
             updateFormMode();
        });
        
        document.getElementById('tts-option').addEventListener('click', () => {
             document.querySelector('input[name="mode"][value="tts"]').checked = true;
             updateFormMode();
        });
        
        ttsEngineSelect.addEventListener('change', updateSpeakerOptions);

        // Inicialización
        updateFormMode();
        updateSpeakerOptions();
    </script>
</body>
</html>
